
ã“ã®æ§‹æˆã§ã¯ã€**`RootScene.gd`ãŒã™ã¹ã¦ã®UIã¨ã‚²ãƒ¼ãƒ è¦ç´ ã®ç”Ÿæˆãƒ»ç ´æ£„ãƒ»çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆã‚’çµ±æ‹¬ã™ã‚‹ä¸­å¤®ç®¡ç†è€…**ã¨ã—ã¦ã®å½¹å‰²ã‚’æ‹…ã£ã¦ã„ã¾ã™ã€‚

-----

## ðŸ—ºï¸ 1. ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ï¼‰

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã§æ°¸ç¶šçš„ã«åˆ©ç”¨ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚„å®šæ•°ã‚’ä¿æŒã—ã€ã©ã“ã‹ã‚‰ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚

| ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ / ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒŽãƒ¼ãƒ‰ | å½¹å‰² | ä¸»ãªåˆ©ç”¨ã‚·ãƒ¼ãƒ³/ã‚¹ã‚¯ãƒªãƒ—ãƒˆ |
| :--- | :--- | :--- |
| **`MissionManager.gd`** (AutoLoad) | **ãƒŸãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ç®¡ç†**ã€‚JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å…¨ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€è¾žæ›¸ï¼ˆ`loaded_missions`ï¼‰ã¨ã—ã¦ä¿æŒã—ã¾ã™ã€‚ | `MissionSelectUI.gd` (ãƒŸãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ã®ç”Ÿæˆ) |
| **`Global.gd`** (AutoLoad) | **ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šæ•°**ã®å®šç¾©ã€‚UIã®å¹…ã‚„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã¨ã„ã£ãŸå…±é€šã®è¨­å®šå€¤ã‚’å®šç¾©ã—ã¾ã™ã€‚ | `root_scene.gd`, `sidebar.gd` (å®šæ•°ã®å‚ç…§) |

-----

## ðŸ”— 2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–“ã®ä¸»è¦ãªä¾å­˜é–¢ä¿‚

å„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ**ä»–ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚„é–¢æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**ä¾å­˜é–¢ä¿‚ã‚’ç¤ºã—ã¾ã™ã€‚

```mermaid
graph TD
	subgraph Global
		A[MissionManager.gd]
		B[Global.gd]
	end
	
	subgraph Scenes/Scripts
		C[MissionSelectUI.gd]
		D[root_scene.gd]
		E[sidebar.gd]
	end
	
	A --> C
	B --> D
	B --> E
	
	C -- çŠ¶æ…‹é·ç§»ã‚’è¦æ±‚ --> D
	D -- ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’ç”Ÿæˆ/åˆ¶å¾¡ --> E
	D -- MDIã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ç”Ÿæˆ --> F[mdi_window.gd]
```

-----

## ðŸ”„ 3. RootSceneã‚’æ ¸ã¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ç®¡ç†ï¼ˆå®Ÿè¡Œãƒ•ãƒ­ãƒ¼ï¼‰

ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ãƒŸãƒƒã‚·ãƒ§ãƒ³å®Ÿè¡Œã¾ã§ã®æŽ’ä»–çš„ãªç”»é¢åˆ‡ã‚Šæ›¿ãˆã¨ã€æ°¸ç¶šè¦ç´ ã®åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã‚’ç¤ºã—ã¾ã™ã€‚

### RootSceneã®å½¹å‰²ï¼ˆæŽ’ä»–çš„UIã®åˆ‡ã‚Šæ›¿ãˆï¼‰

| é–¢æ•°å | å®Ÿè¡Œãƒˆãƒªã‚¬ãƒ¼ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| :--- | :--- | :--- |
| **`start_main_menu_mode()`** | ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã€ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰æˆ»ã‚‹æ™‚ | 1. é–‹ã„ã¦ã„ã‚‹MDIã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ã™ã¹ã¦å‰Šé™¤ã€‚ 2. **`MainMenuUI`** ã‚’ç”Ÿæˆã—ã€`current_ui_instance`ã«è¨­å®šã€‚ |
| **`Maps_to_mission_select()`** | `MainMenuUI` ã®ã€ŒãƒŸãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã€ãƒœã‚¿ãƒ³ | `switch_full_screen_ui()`ã‚’å‘¼ã³å‡ºã—ã€**`MissionSelectUI`** ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚ |
| **`start_mission_from_details(id)`** | `MissionSelectUI` ã®ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ | 1. `MissionSelectUI`ã‚’å‰Šé™¤ (`current_ui_instance = null`)ã€‚ 2. **`Sidebar`** ã¨ **`SidebarToggle`** ã‚’ `visible = true` ã«ã€‚ 3. `open_window()`ã§**MDIã‚¦ã‚£ãƒ³ãƒ‰ã‚¦**ï¼ˆTerminalãªã©ï¼‰ã‚’ç”Ÿæˆã—ã€ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã¸ç§»è¡Œã€‚ |

### ãƒ•ãƒ­ãƒ¼å›³

```mermaid
graph TD
	%% çŠ¶æ…‹
	Start[ã‚¢ãƒ—ãƒªèµ·å‹•]
	MMenu[MainMenuUI (æŽ’ä»–çš„)]
	MSel[MissionSelectUI (æŽ’ä»–çš„)]
	Game[ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ (Sidebar + MDI)]
	
	%% RootSceneã®åˆ¶å¾¡é–¢æ•°
	R1[RootScene.start_main_menu_mode]
	R2[RootScene.navigate_to_mission_select]
	R3[RootScene.start_mission_from_details]
	R4[RootScene.return_to_main_menu]

	%% é·ç§»
	Start --> R1
	R1 --> MMenu
	
	MMenu -- ãƒœã‚¿ãƒ³æŠ¼ä¸‹ --> R2
	
	R2 --> MSel
	
	MSel -- ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ --> R3
	
	MSel -- æˆ»ã‚‹ãƒœã‚¿ãƒ³ --> R4
	
	R3 --> Game
	
	Game -- ãƒŸãƒƒã‚·ãƒ§ãƒ³çµ‚äº†/ä¸­æ­¢ --> R4
	
	R4 --> MMenu
	
	
	style MMenu fill:#FFC,stroke:#000
	style MSel fill:#FFC,stroke:#000
	style Game fill:#FEE,stroke:#000,stroke-dasharray: 5 5
```
